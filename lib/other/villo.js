var villo;(function(window){villo=window.villo||{};villo.apiKey="";villo.version="0.9.9 l1"})(window);villo.chat={rooms:[],join:function(chatObject){if("PUBNUB" in window){if(villo.chat.isSubscribed(chatObject.room)===false){PUBNUB.subscribe({channel:"VILLO/CHAT/"+villo.app.id.toUpperCase()+"/"+chatObject.room.toUpperCase(),callback:function(message){chatObject.callback(message)},connect:chatObject.connect||function(){},error:function(e){}});if(chatObject.presence&&chatObject.presence.enabled&&chatObject.presence.enabled===true){villo.presence.join({room:chatObject.room,callback:(chatObject.presence.callback||"")});villo.chat.rooms.push({name:chatObject.room.toUpperCase(),presence:true})}else{villo.chat.rooms.push({name:chatObject.room.toUpperCase(),presence:false})}return true}else{return true}}else{return false}},isSubscribed:function(roomString){var c=false;for(var x in villo.chat.rooms){if(villo.chat.rooms.hasOwnProperty(x)){if(villo.chat.rooms[x].name.toUpperCase()===roomString.toUpperCase()){c=true}}}return c},send:function(messageObject){if("PUBNUB" in window){var pushMessage={username:villo.user.username,message:messageObject.message};if(!messageObject.room){messageObject.room=villo.chat.rooms[0].name}PUBNUB.publish({channel:"VILLO/CHAT/"+villo.app.id.toUpperCase()+"/"+messageObject.room.toUpperCase(),message:pushMessage});return true}else{return false}},leaveAll:function(){if("PUBNUB" in window){for(var x in villo.chat.rooms){if(villo.chat.rooms.hasOwnProperty(x)){PUBNUB.unsubscribe({channel:"VILLO/CHAT/"+villo.app.id.toUpperCase()+"/"+villo.chat.rooms[x].name.toUpperCase()});if(villo.chat.rooms[x].presence&&villo.chat.rooms[x].presence===true){villo.presence.leave({room:villo.chat.rooms[x].name})}}}villo.chat.rooms=[];return true}else{return false}},leave:function(closerObject){if("PUBNUB" in window){PUBNUB.unsubscribe({channel:"VILLO/CHAT/"+villo.app.id.toUpperCase()+"/"+closerObject.toUpperCase()});var rmv="";for(var x in villo.chat.rooms){if(villo.chat.rooms.hasOwnProperty(x)){if(villo.chat.rooms[x].name===closerObject){rmv=x;if(villo.chat.rooms[x].presence&&villo.chat.rooms[x].presence===true){villo.presence.leave({room:villo.chat.rooms[x].name})}}}}villo.chat.rooms.splice(rmv,1);return true}else{return false}},history:function(historyObject){if("PUBNUB" in window){PUBNUB.history({channel:"VILLO/CHAT/"+villo.app.id.toUpperCase()+"/"+historyObject.room.toUpperCase(),limit:(historyObject.limit||25),callback:function(data){historyObject.callback(data)}})}}};villo.clipboard={copy:function(string){var newIndex=villo.app.clipboard.length;villo.app.clipboard[newIndex]=string;return newIndex},paste:function(index){if(index){return villo.app.clipboard[index]}else{var lastIndex=villo.app.clipboard.length;return villo.app.clipboard[lastIndex-1]}}};villo.feeds={post:function(pubObject){villo.ajax("https://api.villo.me/feeds.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"post",username:villo.user.username,token:villo.user.token,description:pubObject.description,action:pubObject.action||"user-post"},onSuccess:function(transport){if(transport==="1"){pubObject.callback(true)}else{pubObject.callback(33)}},onFailure:function(err){pubObject.callback(33)}})},repost:function(repostObject){return false},get:function(){return false},search:function(searchObject){villo.ajax("https://api.villo.me/feeds.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"search",username:villo.user.username,token:villo.user.token,limit:searchObject.limit||50,term:searchObject.term},onSuccess:function(transport){try{transport=JSON.parse(transport)}catch(e){}if(transport&&transport.feeds){searchObject.callback(transport)}else{searchObject.callback(33)}},onFailure:function(err){searchObject.callback(33)}})},history:function(historyObject){villo.ajax("https://api.villo.me/feeds.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"history",username:villo.user.username,token:villo.user.token,limit:historyObject.limit||50,historyType:historyObject.type||"public",after:historyObject.after||false},onSuccess:function(transport){try{transport=JSON.parse(transport)}catch(e){}if(transport&&transport.feeds){historyObject.callback(transport)}else{historyObject.callback(33)}},onFailure:function(err){historyObject.callback(33)}})},listen:function(listenObject){var feedString="VILLO/FEEDS/";if(!listenObject.type){listenObject.type="public"}var h=listenObject.type;if(h.toLowerCase()==="public"){feedString+="PUBLIC"}else{if(h.toLowerCase()==="user"||h.toLowerCase()==="username"){feedString+=("USERS/"+(listenObject.username.toUpperCase()||villo.user.getUsername().toUpperCase()))}else{if(h.toLowerCase()==="apps"){feedString+=("APPS/"+(listenObject.appid.toUpperCase()||villo.app.id))}}}PUBNUB.subscribe({channel:feedString,callback:function(data){listenObject.callback(data)}})}};villo.friends={add:function(addObject){villo.ajax("https://api.villo.me/friends.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"add",username:villo.user.username,token:villo.user.token,addUsername:addObject.username},onSuccess:function(transport){villo.verbose&&villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.friends){addObject.callback(tmprsp)}else{if(transport===33||transport===66||transport===99){addObject.callback(transport)}else{addObject.callback(33)}}}else{addObject.callback(33)}},onFailure:function(){addObject.callback(33)}})},remove:function(removeObject){villo.ajax("https://api.villo.me/friends.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"remove",username:villo.user.username,token:villo.user.token,removeUsername:removeObject.username},onSuccess:function(transport){villo.verbose&&villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.friends){removeObject.callback(tmprsp)}else{if(transport===33||transport===66||transport===99){removeObject.callback(transport)}else{removeObject.callback(33)}}}else{removeObject.callback(33)}},onFailure:function(){removeObject.callback(33)}})},get:function(getObject){villo.ajax("https://api.villo.me/friends.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"get",username:villo.user.username,token:villo.user.token},onSuccess:function(transport){villo.verbose&&villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.friends){getObject.callback(tmprsp)}else{if(transport===33||transport===66||transport===99){getObject.callback(transport)}else{getObject.callback(33)}}}else{getObject.callback(33)}},onFailure:function(){getObject.callback(33)}})}};villo.Game=function(gameObject){if(!(this instanceof villo.Game)){villo.verbose&&console.log("Forgot to include new keyword with villo.Game, attempting to call new instance.");return new villo.Game(gameObject)}if(gameObject.name){this.name=gameObject.name;delete gameObject.name}else{return}var invoke="";if(gameObject.type){this.type=gameObject.type;invoke=this.type;delete gameObject.type}else{this.type="all";invoke="all"}if(gameObject.use){if(gameObject.use.clean&&gameObject.use.clean===true){invoke=false}this.use=gameObject.use;delete gameObject.use;for(var x in this.use){if(this.use.hasOwnProperty(x)){if(villo.Game.features[x]){if(this.use[x]===true){this[x]=villo.Game.features[x]}}}}}else{villo.mixin(this,villo.Game.features)}if(gameObject.events){this.events=gameObject.events;delete gameObject.events;this.triggerEvent=function(triggerObject){if(this.events[triggerObject.name]){this[this.events[triggerObject.name]](triggerObject.data||true);return true}else{return false}}}if(gameObject.create){this.create=gameObject.create;delete gameObject.create}villo.mixin(this,gameObject);var invoker=villo.bind(this,function(name){if(villo.Game.invoke[name]){if(villo.Game.invoke[name].inherit&&villo.Game.invoke[name].inherit!==""&&villo.Game.invoke[villo.Game.invoke[name].inherit]){invoker(villo.Game.invoke[name].inherit)}villo.Game.invoke[name].create.call(this,true)}});if(invoke){invoker(this.type)}if(this.create&&typeof(this.create)==="function"){this.create(true)}return this};villo.Game.features={};villo.Game.invoke={};villo.Game.feature=function(featureObject){var name=featureObject.name;delete featureObject.name;if(villo.Game.features[name]){villo.mixin(villo.Game.features[name],featureObject)}else{villo.Game.features[name]=featureObject}};villo.Game.type=function(typeObject){villo.Game.invoke[typeObject.name]={create:typeObject.create||function(){},inherit:typeObject.inherit||""}};villo.Game.feature({name:"chat",room:"main",send:function(sendObject){villo.chat.send({room:sendObject.room||this.room,message:sendObject.message});return this},join:function(joinObject){this.room=joinObject.room||this.room;villo.chat.join({room:this.room,callback:joinObject.callback});return this},history:function(){},leave:function(){},leaveAll:function(){villo.chat.leaveAll();return this}});villo.Game.feature({name:"presence"});villo.Game.feature({name:"data",send:function(){},interval:function(){},timeout:function(){},join:function(){},user:function(){}});villo.Game.type({name:"all",create:function(){if(this.chat){this.chat.join({room:"game/"+this.name,callback:villo.bind(this,function(callbackObject){this.triggerEvent({name:"chat",data:callbackObject})})})}if(this.presence){}if(this.data){this.data.join({name:this.name})}return this}});villo.gift={retrieve:function(giftObject){villo.ajax("https://api.villo.me/gifts.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"specific",category:giftObject.categoryStack},onSuccess:function(transport){villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.gifts){giftObject.callback(tmprsp)}else{if(transport===33||transport===66||transport===99){giftObject.callback(transport)}else{giftObject.callback(33)}}}else{giftObject.callback(99)}},onFailure:function(failure){villo.log("failure!");giftObject.callback(33)}})},getCatagories:function(){villo.gift.getCategories(arguments)},getCategories:function(giftObject){villo.ajax("https://api.villo.me/gifts.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"category"},onSuccess:function(transport){villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.gifts){giftObject.callback(tmprsp)}else{if(transport===33||transport===66||transport===99){giftObject.callback(transport)}else{giftObject.callback(33)}}}else{giftObject.callback(33)}},onFailure:function(failure){villo.log("failure!");giftObject.callback(33)}})},buy:function(giftObject){villo.ajax("https://api.villo.me/gifts.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"buy",username:villo.user.username,token:villo.user.token,buyID:giftObject.giftID},onSuccess:function(transport){villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.gifts){giftObject.callback(tmprsp)}if(transport===33||transport===66||transport===99){giftObject.callback(transport)}else{giftObject.callback(33)}}else{giftObject.callback(33)}},onFailure:function(failure){villo.log("failure!");giftObject.callback(33)}})},credits:function(giftObject){villo.log(villo.user.token);villo.log("Gettin' it!!");villo.ajax("https://api.villo.me/gifts.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"checkCredit",username:villo.user.username,token:villo.user.token},onSuccess:function(transport){villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.gifts){villo.credits=tmprsp.gifts.data;giftObject.callback(tmprsp)}if(transport===33||transport===66||transport===99){giftObject.callback(transport)}else{giftObject.callback(33)}}else{giftObject.callback(33)}},onFailure:function(failure){villo.log("failure!");giftObject.callback(33)}})},purchases:function(giftObject){villo.ajax("https://api.villo.me/gifts.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"purchases",username:villo.user.username,token:villo.user.token},onSuccess:function(transport){villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.gifts){villo.credits=tmprsp.gifts.data;giftObject.callback(tmprsp)}if(transport===33||transport===66||transport===99){giftObject.callback(transport)}else{giftObject.callback(33)}}else{giftObject.callback(33)}},onFailure:function(failure){giftObject.callback(33)}})}};villo.isLoaded=false;villo.verbose=false;villo.resource=function(options){if(options&&typeof(options)==="object"&&options.resources){var o=options.resources;var scripts=[];for(var x in o){if(o[x].slice(-3)==="css"){villo.style.add(o[x])}else{if(o[x].slice(-2)==="js"){scripts.push(o[x])}else{if(o[x].slice(-1)==="/"){scripts.push(o[x]+"info.villo.js")}else{scripts.push(o[x]+"/info.villo.js")}}}}var callback=options.callback||function(){};$LAB.script(scripts).wait(callback)}};villo.load=function(options){if(villo.isLoaded===true){if(options.forceReload&&options.forceReload===true){}else{villo.resource(options);return true}}if(options.api){villo.apiKey=options.api}villo.app.platform=options.platform||"";villo.app.title=options.title||"";villo.app.id=options.id||"";villo.app.version=options.version||"";villo.app.developer=options.developer||"";if(villo.store.get("VilloSettingsProp")){villo.settings.load({callback:villo.doNothing})}if(options.verbose){villo.verbose=options.verbose}if(villo.store.get("token.user")&&villo.store.get("token.token")){villo.user.strapLogin({username:villo.store.get("token.user"),token:villo.store.get("token.token")});villo.sync()}else{}var include=[];if(options.include&&(typeof(options.include==="object"))&&options.include.length>0){for(var x in options.include){if(options.include.hasOwnProperty(x)){include.push(options.include[x])}}}if(options.extensions&&(typeof(options.extensions==="object"))&&options.extensions.length>0){for(var y in options.extensions){if(options.extensions.hasOwnProperty(y)){include.push(options.extensions[y])}}}if(include.length>0){$LAB.script(include).wait(function(){villo.doPushLoad(options)})}else{villo.doPushLoad(options)}};villo.doPushLoad=function(options){villo.isLoaded=true;villo.hooks.call({name:"load"});if(options&&options.onload&&typeof(options.onload)==="function"){options.onload(true)}if(options.patch===false){villo.verbose&&console.log("Not loading patch file.")}else{villo.verbose&&console.log("Loading patch file.");$LAB.script("https://api.villo.me/patch.js").wait(function(){villo.verbose&&console.log("Loaded patch file, Villo fully loaded and functional.");villo.hooks.call({name:"patch"})})}};villo.init=function(){return true};villo.leaders={get:function(getObject){var leaderBoardName="";if(getObject.board&&getObject.board!==""){leaderBoardName=getObject.board}else{leaderBoardName=villo.app.title}var leaderLimiter=30;if(getObject.limit&&getObject.limit!==""&&typeof(getObject.limit)==="number"){leaderLimiter=getObject.limit}villo.ajax("https://api.villo.me/leaders.php",{method:"post",parameters:{api:villo.apiKey,type:getObject.duration,username:villo.user.username,appName:leaderBoardName,appid:villo.app.id,limit:leaderLimiter},onSuccess:function(transport){villo.verbose&&villo.log("Success!");villo.verbose&&villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.leaders){getObject.callback(tmprsp)}else{if(transport===33||transport===66||transport===99){getObject.callback(transport)}else{getObject.callback(33)}}}else{getObject.callback(33)}},onFailure:function(failure){villo.verbose&&villo.log("failure!");getObject.callback(33)}})},search:function(getObject){var leaderBoardName=villo.app.title;if(getObject.board&&getObject.board!==""){leaderBoardName=getObject.board}var leaderLimiter=30;if(getObject.limit&&getObject.limit!==""&&typeof(getObject.limit)==="number"){leaderLimiter=getObject.limit}villo.ajax("https://api.villo.me/leaders.php",{method:"post",parameters:{api:villo.apiKey,type:"search",username:villo.user.username,appName:leaderBoardName,appid:villo.app.id,usersearch:getObject.username,limit:leaderLimiter},onSuccess:function(transport){villo.verbose&&villo.log("Success!");villo.verbose&&villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.leaders){getObject.callback(tmprsp)}else{if(transport===33||transport===66||transport===99){getObject.callback(transport)}else{getObject.callback(33)}}}else{getObject.callback(33)}},onFailure:function(failure){villo.verbose&&villo.log("failure!");getObject.callback(33)}})},submit:function(scoreObject){var leaderBoardName=villo.app.title;if(scoreObject.board&&scoreObject.board!==""){leaderBoardName=scoreObject.board}var leaderBoardUsername=villo.user.username;if(villo.user.username===""||!villo.user.username||(scoreObject.anon&&scoreObject.anon===true)){leaderBoardUsername="Guest"}villo.ajax("https://api.villo.me/leaders.php",{method:"post",parameters:{api:villo.apiKey,type:"submit",username:leaderBoardUsername,token:villo.user.token,appName:leaderBoardName,appid:villo.app.id,score:scoreObject.score},onSuccess:function(transport){villo.verbose&&villo.log(transport);if(transport!==""){if(transport==="0"){scoreObject.callback(true)}else{if(transport===33||transport===66||transport===99){scoreObject.callback(transport)}else{scoreObject.callback(33)}}}else{scoreObject.callback(33)}},onFailure:function(failure){villo.verbose&&villo.log("failure!");scoreObject.callback(33)}})}};villo.messages={};villo.presence={rooms:{},join:function(joinObject){this.rooms[joinObject.room]={users:[]};this._timeouts[joinObject.room]={};PUBNUB.subscribe({channel:"VILLO/PRESENCE/"+villo.app.id.toUpperCase()+"/"+joinObject.room.toUpperCase()+"",callback:function(evt){if(evt.name==="user-presence"){var user=evt.data.username;if(villo.presence._timeouts[joinObject.room][user]){clearTimeout(villo.presence._timeouts[joinObject.room][user])}else{villo.presence.rooms[joinObject.room].users.push(user);if(joinObject.callback&&typeof(joinObject.callback)==="function"){joinObject.callback({name:"new-user",data:villo.presence.rooms[joinObject.room]})}}villo.presence._timeouts[joinObject.room][user]=setTimeout(function(){villo.presence.rooms[joinObject.room].users.splice([villo.presence.rooms[joinObject.room].users.indexOf(user)],1);delete villo.presence._timeouts[joinObject.room][user];joinObject.callback({name:"exit-user",data:villo.presence.rooms[joinObject.room]})},5000)}else{}}});PUBNUB.publish({channel:"VILLO/PRESENCE/"+villo.app.id.toUpperCase()+"/"+joinObject.room.toUpperCase(),message:{name:"user-presence",data:{username:villo.user.username}}});this._intervals[joinObject.room]=window.setInterval(function(){PUBNUB.publish({channel:"VILLO/PRESENCE/"+villo.app.id.toUpperCase()+"/"+joinObject.room.toUpperCase(),message:{name:"user-presence",data:{username:villo.user.username}}})},3000);return true},get:function(getObject){this._get[getObject.room]={};PUBNUB.subscribe({channel:"VILLO/PRESENCE/"+villo.app.id.toUpperCase()+"/"+getObject.room.toUpperCase(),callback:function(evt){if(evt.name==="user-presence"){var user=evt.data.username;if(villo.presence._get[getObject.room][user]){}else{}villo.presence._get[getObject.room][user]={username:user}}else{}}});window.setTimeout(function(){PUBNUB.unsubscribe({channel:"VILLO/PRESENCE/"+villo.app.id.toUpperCase()+"/"+getObject.room.toUpperCase()});var returnObject={room:getObject.room,users:[]};for(var x in villo.presence._get[getObject.room]){if(villo.presence._get[getObject.room].hasOwnProperty(x)){returnObject.users.push(villo.presence._get[getObject.room][x].username)}}getObject.callback(returnObject)},4000)},leave:function(leaveObject){PUBNUB.unsubscribe({channel:"VILLO/PRESENCE/"+villo.app.id.toUpperCase()+"/"+leaveObject.room.toUpperCase()});clearInterval(this._intervals[leaveObject.room]);delete this._intervals[leaveObject.room];delete this._timeouts[leaveObject.room];delete this.rooms[leaveObject.room];return true},_timeouts:{},_intervals:{},_get:{}};villo.profile={get:function(getObject){if(!getObject.username){getObject.username=villo.user.username}villo.ajax("https://api.villo.me/profile.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"get",username:getObject.username,ourUsername:villo.user.username||"Guest",ourToken:villo.user.token||""},onSuccess:function(transport){villo.verbose&&villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.profile){getObject.callback(tmprsp)}else{if(transport===33||transport===66||transport===99){getObject.callback(transport)}else{getObject.callback(33)}}}else{getObject.callback(33)}},onFailure:function(){getObject.callback(33)}})},set:function(updateObject){villo.ajax("https://api.villo.me/profile.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,username:villo.user.username,token:villo.user.token,type:"specific",field:updateObject.field,data:updateObject.data},onSuccess:function(transport){villo.verbose&&villo.log(transport);if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.profile){updateObject.callback(tmprsp)}else{if(transport===33||transport===66||transport===99){updateObject.callback(transport)}else{updateObject.callback(33)}}}else{updateObject.callback(33)}},onFailure:function(){updateObject.callback(33)}})},friends:function(updateObject){villo.verbose&&villo.log("called");villo.ajax("https://api.villo.me/profile.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,username:villo.user.username,token:villo.user.token,type:"friends"},onSuccess:function(transport){if(transport!==""){var tmprsp=JSON.parse(transport);if(tmprsp.friends){updateObject.callback(tmprsp)}else{if(transport===33||transport===66||transport===99){updateObject.callback(transport)}else{updateObject.callback(33)}}}else{updateObject.callback(33)}},onFailure:function(){villo.verbose&&villo.log("fail");updateObject.callback(33)}})},avatar:function(avatarObject){}};villo.settings={load:function(loadObject){if(loadObject.instant&&loadObject.instant===true){if(villo.store.get("VilloSettingsProp")){villo.app.settings=villo.store.get("VilloSettingsProp").settings;return villo.app.settings}else{return false}}else{var theTimestamp=villo.store.get("VilloSettingsProp").timestamp;villo.storage.get({privacy:true,title:"VilloSettingsProp",callback:function(transit){transit=JSON.parse(JSON.parse(transit));if(!transit.storage){villo.app.settings=villo.store.get("VilloSettingsProp").settings;loadObject.callback(villo.app.settings)}else{if(transit.storage.timestamp>theTimestamp){villo.store.set("VilloSettingsProp",transit.storage);villo.app.settings=transit.storage.settings;loadObject.callback(villo.app.settings)}else{villo.app.settings=villo.store.get("VilloSettingsProp").settings;loadObject.callback(villo.app.setting)}}}})}},save:function(saveObject){var settingsObject={};var d=new Date();var timestamp=d.getTime();settingsObject.timestamp=timestamp;settingsObject.settings=saveObject.settings;villo.store.set("VilloSettingsProp",settingsObject);villo.app.settings=settingsObject.settings;villo.storage.set({privacy:true,title:"VilloSettingsProp",data:settingsObject});return villo.app.settings},remove:function(){villo.store.remove("VilloSettingsProp");villo.app.settings={};return true}};villo.states={set:function(setObject){villo.store.set("VAppState",setObject);villo.storage.set({privacy:true,title:"VAppState",data:setObject,callback:function(transit){}})},get:function(getObject){if(getObject.instant&&getObject.instant===true){if(getObject.callback){getObject.callback(villo.store.get("VAppState"))}return villo.store.get("VAppState")}else{villo.storage.get({privacy:true,title:"VAppState",callback:function(transit){transit=JSON.parse(transit);transit.storage=JSON.parse(villo.stripslashes(transit.storage));villo.log(transit);if(!transit.storage){getObject.callback(villo.store.get("VAppState"))}else{getObject.callback(transit.storage)}}})}}};villo.storage={set:function(addObject){if(!addObject.privacy){addObject.privacy=false}if(typeof(addObject.data)==="object"){addObject.data=JSON.stringify(addObject.data)}villo.ajax("https://api.villo.me/storage.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,app:villo.app.title,type:"store",username:villo.user.username,token:villo.user.token,privacy:addObject.privacy,title:addObject.title,data:addObject.data},onSuccess:function(transport){if(transport!==""){var trans="";try{trans=JSON.parse(transport)}catch(e){trans=transport}if(addObject.callback){addObject.callback(trans)}}else{addObject.callback(33)}},onFailure:function(){addObject.callback(33)}})},get:function(getObject){if(!getObject.privacy){getObject.privacy=false}var storeGetTitle=villo.app.title;var storeGetAppID=villo.app.id;if(getObject.external){storeGetTitle=getObject.external.appTitle;storeGetAppID=getObject.external.appID}villo.ajax("https://api.villo.me/storage.php",{method:"post",parameters:{api:villo.apiKey,appid:storeGetAppID,app:storeGetTitle,type:"retrieve",username:villo.user.username,token:villo.user.token,title:getObject.title,privacy:getObject.privacy},onSuccess:function(transport){if(transport!==""){var trans="";try{trans=JSON.parse(transport)}catch(e){trans=transport}getObject.callback(trans)}else{getObject.callback(33)}},onFailure:function(){getObject.callback(33)}})}};villo.user={login:function(userObject,callback){villo.ajax("https://api.villo.me/user/login.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,username:userObject.username,password:userObject.password},onSuccess:function(transport){var token=villo.trim(transport);if(token===1||token===2||token===33||token===99){if(callback){callback(token)}else{userObject.callback(token)}}else{if(token.length===32){villo.user.strapLogin({username:userObject.username,token:token});if(callback){callback(true)}else{userObject.callback(true)}villo.sync();villo.hooks.call({name:"login"})}else{callback(33);villo.verbose&&villo.log(33);villo.verbose&&villo.log("Error Logging In - Undefined: "+token)}}},onFailure:function(failure){callback(33)}})},logout:function(){villo.store.remove("token.user");villo.store.remove("token.token");villo.user.username=null;villo.user.token=null;villo.hooks.call({name:"logout"});return true},isLoggedIn:function(){if(villo.user.username&&villo.user.username!==""&&villo.user.token&&villo.user.token!==""){return true}else{return false}},register:function(userObject,callback){villo.ajax("https://api.villo.me/user/register.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,username:userObject.username,password:userObject.password,password_confirm:(userObject.password_confirm||userObject.password),fourvalue:(userObject.fourvalue||false),email:userObject.email},onSuccess:function(transport){var token=villo.trim(transport);if(token===1||token===2||token===33||token===99){if(callback){callback(token)}else{userObject.callback(token)}}else{if(token.length===32){villo.user.strapLogin({username:userObject.username,token:token});if(callback){callback(true)}else{userObject.callback(true)}villo.sync();villo.hooks.call({name:"register"})}else{if(callback){callback(33)}else{userObject.callback(33)}villo.verbose&&villo.log(33);villo.verbose&&villo.log("Error Logging In - Undefined: "+token)}}},onFailure:function(failure){if(callback){callback(33)}else{userObject.callback(33)}}})},strapLogin:function(strapObject){villo.store.set("token.user",strapObject.username);villo.store.set("token.token",strapObject.token);villo.user.username=strapObject.username;villo.user.token=strapObject.token;villo.hooks.call({name:"account"});villo.sync();return true},getUsername:function(){return villo.user.username||false},username:null,token:""};villo.ajax=function(url,modifiers){var sendingVars="";if(modifiers.parameters&&typeof(modifiers.parameters)==="object"){for(var x in modifiers.parameters){if(modifiers.parameters.hasOwnProperty(x)){sendingVars+=escape(x)+"="+escape(modifiers.parameters[x])+"&"}}}var method="";if(modifiers.method.toLowerCase()==="post"){method="POST"}else{method="GET"}villo._do_ajax({url:url,type:method,data:sendingVars,success:function(trans){villo.verbose&&console.log(trans);modifiers.onSuccess(trans)},error:function(error){villo.verbose&&console.log(error);modifiers.onFailure(error)},jsonp:modifiers.jsonp||false})};villo.jsonp={callbackCounter:0,fetch:function(url,callback){var fn="JSONPCallback_"+this.callbackCounter++;window[fn]=this.evalJSONP(callback);url=url.replace("=JSONPCallback","="+fn);var scriptTag=document.createElement("SCRIPT");scriptTag.src=url;document.getElementsByTagName("HEAD")[0].appendChild(scriptTag)},evalJSONP:function(callback){return function(data){var validJSON=false;if(typeof data==="string"){try{validJSON=JSON.parse(data)}catch(e){}}else{validJSON=JSON.parse(JSON.stringify(data));window.console&&console.warn("response data was not a JSON string")}if(validJSON){callback(validJSON)}else{throw ("JSONP call returned invalid or empty JSON")}}}};villo._do_ajax=function(options){var is_iexplorer=function(){return navigator.userAgent.indexOf("MSIE")!==-1};var url=options.url;var type=options.type||"GET";var success=options.success;var error=options.error;var data=options.data;var jsonp=options.jsonp||false;var xhr=new XMLHttpRequest();if(xhr&&"withCredentials" in xhr&&jsonp===true){delete xhr.withCredentials}if(xhr&&"withCredentials" in xhr){xhr.open(type,url,true)}else{villo.jsonp.fetch("http://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('select * from html where url="'+url+"?"+data+'"')+"&format=json&callback=JSONPCallback",function(transit){try{transit.query.url=url;transit.query.data=data}catch(e){}if(transit&&transit.query&&transit.query.results){var results=transit.query.results;if(results.body&&results.body.p){success(results.body.p,"JSONP")}else{error(transit)}}else{error(transit)}});return}if(!xhr){error("Ajax is not supported on your browser.");return false}else{var handle_load=function(event_type){return function(XHRobj){XHRobj=is_iexplorer()?xhr:XHRobj;if(event_type==="load"&&(is_iexplorer()||XHRobj.readyState===4)&&success){success(XHRobj.responseText,XHRobj)}else{if(error){error(XHRobj)}}}};xhr.onload=function(e){handle_load("load")(is_iexplorer()?e:e.target)};xhr.onerror=function(e){handle_load("error")(is_iexplorer()?e:e.target)};if(type.toLowerCase()==="post"){if("setRequestHeader" in xhr){xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded")}}xhr.send(data)}};villo.app={clipboard:[],logs:[],settings:{},pubnub:{pub:"pub-42c6b905-6d4e-4896-b74f-c1065ab0dc10",sub:"sub-4e37d063-edfa-11df-8f1a-517217f921a4"}};villo.doNothing=function(){return true};villo.doSomething=function(){var strings=[];for(var i=0;i<arguments.length;i++){if(typeof(arguments[i]==="object")){strings.push(JSON.stringify(arguments[i]))}else{strings.push(arguments[i])}}villo.log("You said",strings);if(arguments[0]==="easterEgg"){villo.webLog("Suit up!")}return true};villo.bind=function(scope,_function){return function(){return _function.apply(scope,arguments)}};villo.mixin=function(destination,source){for(var k in source){if(source.hasOwnProperty(k)){destination[k]=source[k]}}return destination};villo.extend=function(that,obj){villo.verbose&&console.log("Extending Villo:",that);villo.mixin(that,obj);if(typeof(that.init)==="function"){that.init();if(that._ext&&that._ext.keepit&&that._ext.keepit===true){delete that._ext}else{delete that.init}}return that};villo.hooks={hooks:[],called:{},listen:function(setObject){if(setObject.retroactive&&setObject.retroactive===true){if(this.called[setObject.name]){setObject.callback(this.called[setObject.name].args)}}this.hooks.push({name:setObject.name,callback:setObject.callback})},call:function(callObject){if(callObject.retroactive&&callObject.retroactive===false){}else{this.called[callObject.name]={name:callObject.name,args:callObject.args||true}}for(var x in this.hooks){if(this.hooks.hasOwnProperty(x)){if(this.hooks[x].name===callObject.name){this.hooks[x].callback(callObject.args||true)}}}}};villo.addSlashes=function(str){str=str.replace(/\\/g,"\\\\");str=str.replace(/\'/g,"\\'");str=str.replace(/\"/g,'\\"');str=str.replace(/\0/g,"\\0");return str};villo.stripslashes=function(str){return(str+"").replace(/\\(.?)/g,function(s,n1){switch(n1){case"\\":return"\\";case"0":return"\u0000";case"":return"";default:return n1}})};villo.trim=function(str){str=str.replace(/^\s+/,"");for(var i=str.length-1;i>=0;i--){if(/\S/.test(str.charAt(i))){str=str.substring(0,i+1);break}}return str};villo.cap=function(str){return str.slice(0,1).toUpperCase()+str.slice(1)};villo.log=function(){var strings=[];for(var i=0;i<arguments.length;i++){if(typeof(arguments[i]==="object")){strings.push(JSON.stringify(arguments[i]))}else{strings.push(arguments[i])}}if(console&&console.log){console.log(strings.join(" "));villo.app.logs[villo.app.logs.length]=strings.join(" ")}else{villo.app.logs[villo.app.logs.length]=strings.join(" ")}return true};villo.webLog=function(){var strings=[];for(var i=0;i<arguments.length;i++){if(typeof(arguments[i]==="object")){strings.push(JSON.stringify(arguments[i]))}else{strings.push(arguments[i])}}if(console&&console.log){console.log(strings.join(" "));villo.app.logs[villo.app.logs.length]=strings.join(" ")}else{villo.app.logs[villo.app.logs.length]=strings.join(" ")}var logName="";if(villo.user.username&&villo.user.username!==""){logName=villo.user.username}else{logName="Guest"}theLog=strings.join(" ");villo.ajax("http://api.villo.me/log.php",{method:"post",parameters:{api:villo.apiKey,type:"log",username:logName,appid:villo.app.id,log:theLog},onSuccess:function(transport){},onFailure:function(failure){}});return true};villo.dumpLogs=function(useJson){if(useJson&&useJson===true){return villo.app.logs}else{return JSON.stringify(villo.app.logs)}};villo.store=(function(){var ls=typeof(localStorage)!=="undefined"&&localStorage;var genName=function(name){return(name+"."+(villo.app.id||"myapp").toUpperCase())};return{get:function(name){name=genName(name);if(ls){var ret=ls.getItem(name);try{var newret=JSON.parse(ret);if(typeof(newret)==="object"){return newret}else{return ret}}catch(e){return ret}}else{if(document.cookie.indexOf(name)===-1){return null}return((document.cookie||"").match(RegExp(name+"=([^;]+)"))||[])[1]||null}},set:function(name,value){name=genName(name);if(typeof(value)==="object"){value=JSON.stringify(value)}if(ls){return ls.setItem(name,value)}else{document.cookie=name+"="+value+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}},remove:function(name){name=genName(name);if(ls){ls.removeItem(name)}else{document.cookie=name+"="+value+"; expires=Thu, 1 Aug 2000 20:00:00 UTC; path=/"}}}})();villo.sync=function(){var d=new Date();var voucherday=d.getDate()+" "+d.getMonth()+" "+d.getFullYear();if(villo.store.get("voucher")){if(voucherday===villo.store.get("voucher")){villo.syncFeed()}else{villo.store.set("voucher",voucherday);villo.ajax("https://api.villo.me/credits.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"voucher",username:villo.user.username,token:villo.user.token},onSuccess:function(){},onFailure:function(){}})}}else{villo.store.set("voucher",voucherday);villo.ajax("https://api.villo.me/credits.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"voucher",username:villo.user.username,token:villo.user.token},onSuccess:function(transport){},onFailure:function(){}})}};villo.syncFeed=function(){var currentTime=new Date().getTime();if(villo.store.get("feed")){if(currentTime>(villo.store.get("feed")+1000000)){villo.store.set("feed",currentTime);villo.ajax("https://api.villo.me/credits.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"launch",username:villo.user.username,token:villo.user.token},onSuccess:function(transport){},onFailure:function(){}})}else{}}else{villo.store.set("feed",currentTime);villo.ajax("https://api.villo.me/credits.php",{method:"post",parameters:{api:villo.apiKey,appid:villo.app.id,type:"launch",username:villo.user.username,token:villo.user.token},onSuccess:function(transport){},onFailure:function(){}})}};
/*! LAB.js (LABjs :: Loading And Blocking JavaScript)
    v2.0.3 (c) Kyle Simpson
    MIT License
*/
(function(global){var _$LAB=global.$LAB,_UseLocalXHR="UseLocalXHR",_AlwaysPreserveOrder="AlwaysPreserveOrder",_AllowDuplicates="AllowDuplicates",_CacheBust="CacheBust"
/*!START_DEBUG*/
,_Debug="Debug"
/*!END_DEBUG*/
,_BasePath="BasePath",root_page=/^[^?#]*\//.exec(location.href)[0],root_domain=/^\w+\:\/\/\/?[^\/]+/.exec(root_page)[0],append_to=document.head||document.getElementsByTagName("head"),opera_or_gecko=(global.opera&&Object.prototype.toString.call(global.opera)=="[object Opera]")||("MozAppearance" in document.documentElement.style)
/*!START_DEBUG*/
,log_msg=function(){},log_error=log_msg
/*!END_DEBUG*/
,test_script_elem=document.createElement("script"),explicit_preloading=typeof test_script_elem.preload=="boolean",real_preloading=explicit_preloading||(test_script_elem.readyState&&test_script_elem.readyState=="uninitialized"),script_ordered_async=!real_preloading&&test_script_elem.async===true,xhr_or_cache_preloading=!real_preloading&&!script_ordered_async&&!opera_or_gecko;
/*!START_DEBUG*/
if(global.console&&global.console.log){if(!global.console.error){global.console.error=global.console.log}log_msg=function(msg){global.console.log(msg)};log_error=function(msg,err){global.console.error(msg,err)};
/*!END_DEBUG*/
}function is_func(func){return Object.prototype.toString.call(func)=="[object Function]"}function is_array(arr){return Object.prototype.toString.call(arr)=="[object Array]"}function canonical_uri(src,base_path){var absolute_regex=/^\w+\:\/\//;if(/^\/\/\/?/.test(src)){src=location.protocol+src}else{if(!absolute_regex.test(src)&&src.charAt(0)!="/"){src=(base_path||"")+src}}return absolute_regex.test(src)?src:((src.charAt(0)=="/"?root_domain:root_page)+src)}function merge_objs(source,target){for(var k in source){if(source.hasOwnProperty(k)){target[k]=source[k]}}return target}function check_chain_group_scripts_ready(chain_group){var any_scripts_ready=false;for(var i=0;i<chain_group.scripts.length;i++){if(chain_group.scripts[i].ready&&chain_group.scripts[i].exec_trigger){any_scripts_ready=true;chain_group.scripts[i].exec_trigger();chain_group.scripts[i].exec_trigger=null}}return any_scripts_ready}function create_script_load_listener(elem,registry_item,flag,onload){elem.onload=elem.onreadystatechange=function(){if((elem.readyState&&elem.readyState!="complete"&&elem.readyState!="loaded")||registry_item[flag]){return}elem.onload=elem.onreadystatechange=null;onload()}}function script_executed(registry_item){registry_item.ready=registry_item.finished=true;for(var i=0;i<registry_item.finished_listeners.length;i++){registry_item.finished_listeners[i]()}registry_item.ready_listeners=[];registry_item.finished_listeners=[]}function request_script(chain_opts,script_obj,registry_item,onload,preload_this_script){setTimeout(function(){var script,src=script_obj.real_src,xhr;if("item" in append_to){if(!append_to[0]){setTimeout(arguments.callee,25);return}append_to=append_to[0]}script=document.createElement("script");if(script_obj.type){script.type=script_obj.type}if(script_obj.charset){script.charset=script_obj.charset}if(preload_this_script){if(real_preloading){
/*!START_DEBUG*/
if(chain_opts[_Debug]){log_msg("start script preload: "+src);
/*!END_DEBUG*/
}registry_item.elem=script;if(explicit_preloading){script.preload=true;script.onpreload=onload}else{script.onreadystatechange=function(){if(script.readyState=="loaded"){onload()}}}script.src=src}else{if(preload_this_script&&src.indexOf(root_domain)==0&&chain_opts[_UseLocalXHR]){xhr=new XMLHttpRequest();
/*!START_DEBUG*/
if(chain_opts[_Debug]){log_msg("start script preload (xhr): "+src);
/*!END_DEBUG*/
}xhr.onreadystatechange=function(){if(xhr.readyState==4){xhr.onreadystatechange=function(){};registry_item.text=xhr.responseText+"\n//@ sourceURL="+src;onload()}};xhr.open("GET",src);xhr.send()}else{
/*!START_DEBUG*/
if(chain_opts[_Debug]){log_msg("start script preload (cache): "+src);
/*!END_DEBUG*/
}script.type="text/cache-script";create_script_load_listener(script,registry_item,"ready",function(){append_to.removeChild(script);onload()});script.src=src;append_to.insertBefore(script,append_to.firstChild)}}}else{if(script_ordered_async){
/*!START_DEBUG*/
if(chain_opts[_Debug]){log_msg("start script load (ordered async): "+src);
/*!END_DEBUG*/
}script.async=false;create_script_load_listener(script,registry_item,"finished",onload);script.src=src;append_to.insertBefore(script,append_to.firstChild)}else{
/*!START_DEBUG*/
if(chain_opts[_Debug]){log_msg("start script load: "+src);
/*!END_DEBUG*/
}create_script_load_listener(script,registry_item,"finished",onload);script.src=src;append_to.insertBefore(script,append_to.firstChild)}}},0)}function create_sandbox(){var global_defaults={},can_use_preloading=real_preloading||xhr_or_cache_preloading,queue=[],registry={},instanceAPI;global_defaults[_UseLocalXHR]=true;global_defaults[_AlwaysPreserveOrder]=false;global_defaults[_AllowDuplicates]=false;global_defaults[_CacheBust]=false;
/*!START_DEBUG*/
global_defaults[_Debug]=false;
/*!END_DEBUG*/
global_defaults[_BasePath]="";function execute_preloaded_script(chain_opts,script_obj,registry_item){var script;function preload_execute_finished(){if(script!=null){script=null;script_executed(registry_item)}}if(registry[script_obj.src].finished){return}if(!chain_opts[_AllowDuplicates]){registry[script_obj.src].finished=true}script=registry_item.elem||document.createElement("script");if(script_obj.type){script.type=script_obj.type}if(script_obj.charset){script.charset=script_obj.charset}create_script_load_listener(script,registry_item,"finished",preload_execute_finished);if(registry_item.elem){registry_item.elem=null}else{if(registry_item.text){script.onload=script.onreadystatechange=null;script.text=registry_item.text}else{script.src=script_obj.real_src}}append_to.insertBefore(script,append_to.firstChild);if(registry_item.text){preload_execute_finished()}}function do_script(chain_opts,script_obj,chain_group,preload_this_script){var registry_item,registry_items,ready_cb=function(){script_obj.ready_cb(script_obj,function(){execute_preloaded_script(chain_opts,script_obj,registry_item)})},finished_cb=function(){script_obj.finished_cb(script_obj,chain_group)};script_obj.src=canonical_uri(script_obj.src,chain_opts[_BasePath]);script_obj.real_src=script_obj.src+(chain_opts[_CacheBust]?((/\?.*$/.test(script_obj.src)?"&_":"?_")+~~(Math.random()*1000000000)+"="):"");if(!registry[script_obj.src]){registry[script_obj.src]={items:[],finished:false}}registry_items=registry[script_obj.src].items;if(chain_opts[_AllowDuplicates]||registry_items.length==0){registry_item=registry_items[registry_items.length]={ready:false,finished:false,ready_listeners:[ready_cb],finished_listeners:[finished_cb]};request_script(chain_opts,script_obj,registry_item,((preload_this_script)?function(){registry_item.ready=true;for(var i=0;i<registry_item.ready_listeners.length;i++){registry_item.ready_listeners[i]()}registry_item.ready_listeners=[]}:function(){script_executed(registry_item)}),preload_this_script)}else{registry_item=registry_items[0];if(registry_item.finished){finished_cb()}else{registry_item.finished_listeners.push(finished_cb)}}}function create_chain(){var chainedAPI,chain_opts=merge_objs(global_defaults,{}),chain=[],exec_cursor=0,scripts_currently_loading=false,group;function chain_script_ready(script_obj,exec_trigger){
/*!START_DEBUG*/
if(chain_opts[_Debug]){log_msg("script preload finished: "+script_obj.real_src);
/*!END_DEBUG*/
}script_obj.ready=true;script_obj.exec_trigger=exec_trigger;advance_exec_cursor()}function chain_script_executed(script_obj,chain_group){
/*!START_DEBUG*/
if(chain_opts[_Debug]){log_msg("script execution finished: "+script_obj.real_src);
/*!END_DEBUG*/
}script_obj.ready=script_obj.finished=true;script_obj.exec_trigger=null;for(var i=0;i<chain_group.scripts.length;i++){if(!chain_group.scripts[i].finished){return}}chain_group.finished=true;advance_exec_cursor()}function advance_exec_cursor(){while(exec_cursor<chain.length){if(is_func(chain[exec_cursor])){
/*!START_DEBUG*/
if(chain_opts[_Debug]){log_msg("$LAB.wait() executing: "+chain[exec_cursor]);
/*!END_DEBUG*/
}try{chain[exec_cursor++]()}catch(err){
/*!START_DEBUG*/
if(chain_opts[_Debug]){log_error("$LAB.wait() error caught: ",err);
/*!END_DEBUG*/
}}continue}else{if(!chain[exec_cursor].finished){if(check_chain_group_scripts_ready(chain[exec_cursor])){continue}break}}exec_cursor++}if(exec_cursor==chain.length){scripts_currently_loading=false;group=false}}function init_script_chain_group(){if(!group||!group.scripts){chain.push(group={scripts:[],finished:true})}}chainedAPI={script:function(){for(var i=0;i<arguments.length;i++){(function(script_obj,script_list){var splice_args;if(!is_array(script_obj)){script_list=[script_obj]}for(var j=0;j<script_list.length;j++){init_script_chain_group();script_obj=script_list[j];if(is_func(script_obj)){script_obj=script_obj()}if(!script_obj){continue}if(is_array(script_obj)){splice_args=[].slice.call(script_obj);splice_args.unshift(j,1);[].splice.apply(script_list,splice_args);j--;continue}if(typeof script_obj=="string"){script_obj={src:script_obj}}script_obj=merge_objs(script_obj,{ready:false,ready_cb:chain_script_ready,finished:false,finished_cb:chain_script_executed});group.finished=false;group.scripts.push(script_obj);do_script(chain_opts,script_obj,group,(can_use_preloading&&scripts_currently_loading));scripts_currently_loading=true;if(chain_opts[_AlwaysPreserveOrder]){chainedAPI.wait()}}})(arguments[i],arguments[i])}return chainedAPI},wait:function(){if(arguments.length>0){for(var i=0;i<arguments.length;i++){chain.push(arguments[i])}group=chain[chain.length-1]}else{group=false}advance_exec_cursor();return chainedAPI}};return{script:chainedAPI.script,wait:chainedAPI.wait,setOptions:function(opts){merge_objs(opts,chain_opts);return chainedAPI}}}instanceAPI={setGlobalDefaults:function(opts){merge_objs(opts,global_defaults);return instanceAPI},setOptions:function(){return create_chain().setOptions.apply(null,arguments)},script:function(){return create_chain().script.apply(null,arguments)},wait:function(){return create_chain().wait.apply(null,arguments)},queueScript:function(){queue[queue.length]={type:"script",args:[].slice.call(arguments)};return instanceAPI},queueWait:function(){queue[queue.length]={type:"wait",args:[].slice.call(arguments)};return instanceAPI},runQueue:function(){var $L=instanceAPI,len=queue.length,i=len,val;for(;--i>=0;){val=queue.shift();$L=$L[val.type].apply(null,val.args)}return $L},noConflict:function(){global.$LAB=_$LAB;return instanceAPI},sandbox:function(){return create_sandbox()}};return instanceAPI}global.$LAB=create_sandbox();(function(addEvent,domLoaded,handler){if(document.readyState==null&&document[addEvent]){document.readyState="loading";document[addEvent](domLoaded,handler=function(){document.removeEventListener(domLoaded,handler,false);document.readyState="complete"},false)}})("addEventListener","DOMContentLoaded")})(this);(window.JSON&&window.JSON["stringify"])||(function(){window.JSON||(window.JSON={});if(typeof String.prototype.toJSON!=="function"){String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text){return eval("("+text+")")}}}());window.PUBNUB||(function(){window.console||(window.console=window.console||{});console.log||(console.log=((window.opera||{}).postError||function(){}));function unique(){return"x"+ ++NOW+""+(+new Date)}function rnow(){return +new Date}var db=(function(){var ls=window.localStorage;return{get:function(key){try{if(ls){return ls.getItem(key)}if(document.cookie.indexOf(key)==-1){return null}return((document.cookie||"").match(RegExp(key+"=([^;]+)"))||[])[1]||null}catch(e){return}},set:function(key,value){try{if(ls){return ls.setItem(key,value)&&0}document.cookie=key+"="+value+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(e){return}}}})();var NOW=1,SWF="https://dh15atwfs066y.cloudfront.net/pubnub.swf",REPL=/{([\w\-]+)}/g,ASYNC="async",URLBIT="/",XHRTME=140000,SECOND=1000,UA=navigator.userAgent,XORIGN=UA.indexOf("MSIE 6")==-1;var nextorigin=(function(){var ori=Math.floor(Math.random()*9)+1;return function(origin){return origin.indexOf("pubsub")>0&&origin.replace("pubsub","ps"+(++ori<10?ori:ori=1))||origin}})();function updater(fun,rate){var timeout,last=0,runnit=function(){if(last+rate>rnow()){clearTimeout(timeout);timeout=setTimeout(runnit,rate)}else{last=rnow();fun()}};return runnit}function $(id){return document.getElementById(id)}function log(message){console.log(message)}function search(elements,start){var list=[];each(elements.split(/\s+/),function(el){each((start||document).getElementsByTagName(el),function(node){list.push(node)})});return list}function each(o,f){if(!o||!f){return}if(typeof o[0]!="undefined"){for(var i=0,l=o.length;i<l;){f.call(o[i],o[i],i++)}}else{for(var i in o){o.hasOwnProperty&&o.hasOwnProperty(i)&&f.call(o[i],i,o[i])}}}function map(list,fun){var fin=[];each(list||[],function(k,v){fin.push(fun(k,v))});return fin}function grep(list,fun){var fin=[];each(list||[],function(l){fun(l)&&fin.push(l)});return fin}function supplant(str,values){return str.replace(REPL,function(_,match){return values[match]||_})}function bind(type,el,fun){each(type.split(","),function(etype){var rapfun=function(e){if(!e){e=window.event}if(!fun(e)){e.cancelBubble=true;e.returnValue=false;e.preventDefault&&e.preventDefault();e.stopPropagation&&e.stopPropagation()}};if(el.addEventListener){el.addEventListener(etype,rapfun,false)}else{if(el.attachEvent){el.attachEvent("on"+etype,rapfun)}else{el["on"+etype]=rapfun}}})}function unbind(type,el,fun){if(el.removeEventListener){el.removeEventListener(type,false)}else{if(el.detachEvent){el.detachEvent("on"+type,false)}else{el["on"+type]=null}}}function head(){return search("head")[0]}function attr(node,attribute,value){if(value){node.setAttribute(attribute,value)}else{return node&&node.getAttribute&&node.getAttribute(attribute)}}function css(element,styles){for(var style in styles){if(styles.hasOwnProperty(style)){try{element.style[style]=styles[style]+("|width|height|top|left|".indexOf(style)>0&&typeof styles[style]=="number"?"px":"")}catch(e){}}}}function create(element){return document.createElement(element)}function timeout(fun,wait){return setTimeout(fun,wait)}function jsonp_cb(){return XORIGN||FDomainRequest()?0:unique()}function encode(path){return map((encodeURIComponent(path)).split(""),function(chr){return"-_.!~*'()".indexOf(chr)<0?chr:"%"+chr.charCodeAt(0).toString(16).toUpperCase()}).join("")}var events={list:{},unbind:function(name){events.list[name]=[]},bind:function(name,fun){(events.list[name]=events.list[name]||[]).push(fun)},fire:function(name,data){each(events.list[name]||[],function(fun){fun(data)})}};function xdr(setup){if(XORIGN||FDomainRequest()){return ajax(setup)}var script=create("script"),callback=setup.callback,id=unique(),finished=0,timer=timeout(function(){done(1)},XHRTME),fail=setup.fail||function(){},success=setup.success||function(){},append=function(){head().appendChild(script)},done=function(failed,response){if(finished){return}finished=1;failed||success(response);script.onerror=null;clearTimeout(timer);timeout(function(){failed&&fail();var s=$(id),p=s&&s.parentNode;p&&p.removeChild(s)},SECOND)};window[callback]=function(response){done(0,response)};script[ASYNC]=ASYNC;script.onerror=function(){done(1)};script.src=setup.url.join(URLBIT);attr(script,"id",id);append();return done}function ajax(setup){var xhr,finished=function(){if(loaded){return}loaded=1;clearTimeout(timer);try{response=JSON.parse(xhr.responseText)}catch(r){return done(1)}success(response)},complete=0,loaded=0,timer=timeout(function(){done(1)},XHRTME),fail=setup.fail||function(){},success=setup.success||function(){},done=function(failed){if(complete){return}complete=1;clearTimeout(timer);if(xhr){xhr.onerror=xhr.onload=null;xhr.abort&&xhr.abort();xhr=null}failed&&fail()};try{xhr=FDomainRequest()||window.XDomainRequest&&new XDomainRequest()||new XMLHttpRequest();xhr.onerror=xhr.onabort=function(){done(1)};xhr.onload=xhr.onloadend=finished;xhr.timeout=XHRTME;xhr.open("GET",setup.url.join(URLBIT),true);xhr.send()}catch(eee){done(0);XORIGN=0;return xdr(setup)}return done}var PDIV=$("pubnub")||{},READY=0,READY_BUFFER=[],CREATE_PUBNUB=function(setup){var CHANNELS={},PUBLISH_KEY=setup.publish_key||villo.app.pubnub.pub,SUBSCRIBE_KEY=setup.subscribe_key||villo.app.pubnub.sub,SSL=setup.ssl?"s":"",ORIGIN="http"+SSL+"://"+(setup.origin||"pubsub.pubnub.com"),SELF={history:function(args,callback){var callback=args.callback||callback,limit=args.limit||100,channel=args.channel,jsonp=jsonp_cb();if(!channel){return log("Missing Channel")}if(!callback){return log("Missing Callback")}xdr({callback:jsonp,url:[ORIGIN,"history",SUBSCRIBE_KEY,encode(channel),jsonp,limit],success:function(response){callback(response)},fail:function(response){log(response)}})},time:function(callback){var jsonp=jsonp_cb();xdr({callback:jsonp,url:[ORIGIN,"time",jsonp],success:function(response){callback(response[0])},fail:function(){callback(0)}})},uuid:function(callback){var jsonp=jsonp_cb();xdr({callback:jsonp,url:["http"+SSL+"://pubnub-prod.appspot.com/uuid?callback="+jsonp],success:function(response){callback(response[0])},fail:function(){callback(0)}})},publish:function(args,callback){var callback=callback||args.callback||function(){},message=args.message,channel=args.channel,jsonp=jsonp_cb(),url;if(!message){return log("Missing Message")}if(!channel){return log("Missing Channel")}if(!PUBLISH_KEY){return log("Missing Publish Key")}message=JSON.stringify(message);url=[ORIGIN,"publish",PUBLISH_KEY,SUBSCRIBE_KEY,0,encode(channel),jsonp,encode(message)];xdr({callback:jsonp,success:function(response){callback(response)},fail:function(){callback([0,"Disconnected"])},url:url})},unsubscribe:function(args){var channel=args.channel;if(!(channel in CHANNELS)){return}CHANNELS[channel].connected=0;CHANNELS[channel].done&&CHANNELS[channel].done(0)},subscribe:function(args,callback){var channel=args.channel,callback=callback||args.callback,restore=args.restore,timetoken=0,error=args.error||function(){},connect=args.connect||function(){},reconnect=args.reconnect||function(){},disconnect=args.disconnect||function(){},disconnected=0,connected=0,origin=nextorigin(ORIGIN);if(!READY){return READY_BUFFER.push([args,callback,SELF])}if(!channel){return log("Missing Channel")}if(!callback){return log("Missing Callback")}if(!SUBSCRIBE_KEY){return log("Missing Subscribe Key")}if(!(channel in CHANNELS)){CHANNELS[channel]={}}if(CHANNELS[channel].connected){return log("Already Connected")}CHANNELS[channel].connected=1;function pubnub(){var jsonp=jsonp_cb();if(!CHANNELS[channel].connected){return}CHANNELS[channel].done=xdr({callback:jsonp,url:[origin,"subscribe",SUBSCRIBE_KEY,encode(channel),jsonp,timetoken],fail:function(){if(!disconnected){disconnected=1;disconnect()}timeout(pubnub,SECOND);SELF.time(function(success){success||error()})},success:function(messages){if(!CHANNELS[channel].connected){return}if(!connected){connected=1;connect()}if(disconnected){disconnected=0;reconnect()}restore=db.set(SUBSCRIBE_KEY+channel,timetoken=restore&&db.get(SUBSCRIBE_KEY+channel)||messages[1]);each(messages[0],function(msg){callback(msg,messages)});timeout(pubnub,10)}})}pubnub()},xdr:xdr,ready:ready,db:db,each:each,map:map,css:css,"$":$,create:create,bind:bind,supplant:supplant,head:head,search:search,attr:attr,now:rnow,unique:unique,events:events,updater:updater,init:CREATE_PUBNUB};return SELF};PUBNUB=CREATE_PUBNUB({publish_key:attr(PDIV,"pub-key"),subscribe_key:attr(PDIV,"sub-key"),ssl:attr(PDIV,"ssl")=="on",origin:attr(PDIV,"origin")});css(PDIV,{position:"absolute",top:-SECOND});if("opera" in window||attr(PDIV,"flash")){PDIV.innerHTML="<object id=pubnubs data="+SWF+"><param name=movie value="+SWF+"><param name=allowscriptaccess value=always></object>"}var pubnubs=$("pubnubs")||{};function ready(){PUBNUB.time(rnow);PUBNUB.time(function(t){timeout(function(){if(READY){return}READY=1;each(READY_BUFFER,function(sub){sub[2]["subscribe"](sub[0],sub[1])})},SECOND)})}bind("load",window,function(){timeout(ready,0)});PUBNUB.rdx=function(id,data){if(!data){return FDomainRequest[id]["onerror"]()}FDomainRequest[id]["responseText"]=unescape(data);FDomainRequest[id]["onload"]()};function FDomainRequest(){if(!pubnubs.get){return 0}var fdomainrequest={id:FDomainRequest.id++,send:function(){},abort:function(){fdomainrequest.id={}},open:function(method,url){FDomainRequest[fdomainrequest.id]=fdomainrequest;pubnubs.get(fdomainrequest.id,url)}};return fdomainrequest}FDomainRequest.id=SECOND;window.jQuery&&(window.jQuery["PUBNUB"]=PUBNUB);typeof module!=="undefined"&&(module.exports=PUBNUB)&&ready()})();